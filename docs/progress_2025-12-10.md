## Progress – 10 Dec 2025

1. **GPT-5 parsing pipeline**
   - Added Azure OpenAI config hooks (`AZURE_OPENAI_*`) and created `src/parsing_tests/config.py`, `src/parsing_tests/gpt/page_parser.py`, `src/parsing_tests/cli/gpt_runner.py`.
   - Installed `openai` + `pillow`, ran first GPT-5 vision parse on `data/alliade-habitat_no_toc.pdf` (slow, sequential page OCR); output saved under `data/results/gpt/alliade-habitat_no_toc/`.
   - Noted that GPT API rejects request without text content, so messages now include `{"type":"text","text":...}`.

2. **Clause-aware tooling**
   - Implemented `src/parsing_tests/analysis/clause_chunker.py` + `cli.gpt_runner` doc updates.
   - Generated clause-aware chunks for Docling Sherpa payloads:
     - VINCI Docling: `data/results/docling/vinci-ccg-180/vinci-ccg-180_clause_chunks.json` (253 chunks, 44 clauses).
     - VINCI Sherpa: `data/results/sherpa_passthrough/vinci-ccg-180/sherpa_passthrough_vinci-ccg-180_clause_chunks.json` (367 chunks, 58 clauses).
     - Alliade Docling: `data/results/docling/alliade/docling_alliade-habitat_no_toc_clause_chunks.json`.
     - Alliade Sherpa: `data/results/sherpa_passthrough/alliade/llmsherpa_alliade-habitat_no_toc_20251210_135914_clause_chunks.json`.
   - Added `clause_compare.py` to list chunk counts per clause and exported VINCI comparisons (`data/results/reports/vinci_clause_compare_all.txt`).

3. **Docling/Sherpa reruns**
   - Ran Docling on `data/vinci-ccg-180.pdf` (success) and attempted TOC-less variants (`vinci-ccg-180_no_toc.pdf`, `alliade-habitat_no_toc.pdf`) – Docling returns “Error during the process”. Sherpa passthrough succeeds on Alliade no-TOC.
   - Removing TOC via `cli/remove_toc.py --pages 2-6` works for Sherpa but breaks Docling (needs escalation or PDF repair).

4. **Data hygiene**
   - Restructured `data/results/` into parser-specific folders (`docling`, `sherpa_passthrough`, `sherpa_wrapper`, `gpt`, `metadata`, `archive`, `reports`).
   - Tracked clause comparison outputs for VINCI (`data/results/reports/vinci_clause_compare_all.txt`) and Alliade (console output).

### Next Steps
1. Fix Docling failures on TOC-less PDFs (validate PDF integrity, contact Docling/CBAI with task IDs `b8ef4c94-...`, `d061c993-...`, `9b38c07f-...`).
2. Generate clause comparisons for Alliade (`clause_compare.py` output → file) and analyze clause coverage gaps.
3. Optimize GPT parsing (lower DPI, parallel requests, or switch to GPT-4o) for large PDFs.
4. Decide how to handle missing annexes in Sherpa (OCR tuning or fallback parser).
